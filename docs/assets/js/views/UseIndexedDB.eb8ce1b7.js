import{h as e,v as s,i as a,j as l,E as t}from"../element-plus/element-plus.7e07e01a.js";import{C as i,r,J as n,P as o,n as u,o as c,c as m,a4 as p,a as d,S as v,Q as f,L as g,M as j,a3 as h,U as y,aj as w,ak as x,am as _}from"../@vue/@vue.c84d345e.js";import{a as k}from"../animejs/animejs.9d778250.js";import{l as I}from"../lodash/lodash.9be05e92.js";import{l as L}from"../localforage/localforage.c8cfe84f.js";import{_ as C}from"../../index-84f86484.js";import"../dayjs/dayjs.e1eaed1c.js";import"../@element-plus/@element-plus.04d050da.js";import"../lodash-es/lodash-es.55ae658e.js";import"../@vueuse/@vueuse.ee50849e.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../autofit.js/autofit.js.7791d2f0.js";import"../vue-router/vue-router.4574e590.js";import"../nprogress/nprogress.c6946b8a.js";import"../echarts/echarts.6b41119b.js";import"../zrender/zrender.ec62154b.js";import"../tslib/tslib.a4e99503.js";const D=""+new URL("../../file-44ac38b1.svg",import.meta.url).href,b=""+new URL("../../success-dd03ce08.svg",import.meta.url).href,R=i({__name:"PreviewImg",emits:["close"],setup(a,{expose:l,emit:t}){const i=r(!1),m=r(""),p=()=>{t("close")};return l({imgLoading:()=>{i.value=!0},open:e=>{m.value=e,u((()=>{const e=document.querySelector(".el-image__inner.el-image__preview");i.value=!1,e.click()}))}}),(a,l)=>{const t=e,r=s;return n((c(),o(t,{style:{width:"0px"},src:m.value,"preview-src-list":[m.value],"zoom-rate":1.2,"initial-index":0,fit:"cover","hide-on-click-modal":"",onClose:p},null,8,["src","preview-src-list"])),[[r,i.value,void 0,{fullscreen:!0,lock:!0}]])}}}),U=L.createInstance({name:"LocalData"});function z(e){const{message:s,type:l="info",duration:t=2e3}=e;a({message:s,type:l,duration:t})}U.config({driver:L.INDEXEDDB});const B=e=>(w("data-v-015c4259"),e=e(),x(),e),E={id:"use-indexDB"},q=B((()=>d("br",null,null,-1))),M=B((()=>d("h2",null,"图片类型文件可以点击预览",-1))),S={class:"file-list"},A={key:0},O=[B((()=>d("p",null,"暂无文件",-1)))],P=B((()=>d("img",{src:D,alt:"file"},null,-1))),F=["onClick"],J=["onClick"],N=[B((()=>d("path",{d:"M720.298667 768c-12.714667 0-23.850667-4.778667-33.408-14.293333L270.293333 337.066667c-19.072-19.114667-19.072-49.322667 0-66.816 19.114667-19.072 49.322667-19.072 66.816 0l416.597334 415.018666c19.072 19.072 19.072 49.28 0 66.773334-9.557333 11.136-22.272 15.914667-33.408 15.914666z",fill:"var(--icon-del)","p-id":"7130"},null,-1))),B((()=>d("path",{d:"M303.701333 768c-12.714667 0-23.850667-4.778667-33.408-14.293333-19.072-19.114667-19.072-49.322667 0-66.816l415.018667-416.597334c19.072-19.072 49.28-19.072 66.773333 0 19.114667 19.114667 19.114667 49.322667 0 66.816l-414.976 416.597334a45.781333 45.781333 0 0 1-33.408 14.293333z",fill:"var(--icon-del)","p-id":"7131"},null,-1)))],Q=B((()=>d("img",{class:"icon-success",src:b,alt:"√"},null,-1))),T=C(i({__name:"UseIndexedDB",setup(e){const s=r(),a=r([]);U.getItem("fileList").then((e=>{e&&e.forEach((e=>{a.value.push(e)}))}));const i=(e,s)=>{s.findIndex((s=>s.name===e.name))!==I.findLastIndex(s,(s=>s.name===e.name))&&(s.pop(),z({message:"文件重复，已取消该文件此次上传",type:"warning"})),a.value=s},n=r(""),o=r(),u=e=>{var s;null==(s=o.value)||s.imgLoading();const a=new FileReader;a.readAsDataURL(e),a.onloadend=()=>{n.value=a.result,setTimeout((()=>{var e;null==(e=o.value)||e.open(n.value)}),2e3)}},w=()=>{const e=[];a.value.forEach((s=>{e.push(_(s))})),U.setItem("fileList",e).then((()=>{z({message:"文件上传成功！",type:"success"})})).catch((()=>{z({message:"文件上传失败！",type:"error"})}))};return(e,r)=>{const x=t,_=l;return c(),m("div",E,[p(" IndexedDB "),q,M,d("div",S,[v(_,{style:{"margin-bottom":"8px"},ref_key:"uploadRef",ref:s,"file-list":a.value,"onUpdate:fileList":r[0]||(r[0]=e=>a.value=e),action:"",multiple:"","auto-upload":!1,"show-file-list":!1,"on-change":i},{trigger:f((()=>[v(x,{type:"primary"},{default:f((()=>[p("选择文件")])),_:1})])),default:f((()=>[v(x,{type:"success",style:{"margin-left":"12px"},onClick:w},{default:f((()=>[p("点击上传文件")])),_:1})])),_:1},8,["file-list"]),0===a.value.length?(c(),m("div",A,O)):g("",!0),(c(!0),m(j,null,h(a.value,(e=>(c(),m("div",{key:e.uid,class:"file-list-main"},[P,d("span",{onClick:s=>(e=>{const s=e.name.lastIndexOf("."),a=e.name.substring(s+1);-1!=["png","jpg","jpeg"].indexOf(a.toLowerCase())&&u(e.raw)})(e)},y(e.name),9,F),(c(),m("svg",{class:"icon-del",onClick:s=>(e=>{const s=a.value.findIndex((s=>s.uid===e.uid)),l=document.querySelectorAll(".file-list-main")[s];k({targets:l,translateY:-100,opacity:0,complete:()=>{a.value=a.value.filter((s=>s.uid!==e.uid))}})})(e),t:"1693400162714",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"7129",width:"200",height:"200"},N,8,J)),Q])))),128))]),v(R,{url:n.value,ref_key:"previewImgRef",ref:o},null,8,["url"])])}}}),[["__scopeId","data-v-015c4259"]]);export{T as default};
